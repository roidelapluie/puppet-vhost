<% if insecure == 'yes' -%>
<VirtualHost <%= ip %>:<%= port %>>

        ServerAdmin <%= serveradmin %>
        ServerName <%= servername %> 
        ServerAlias <% serveralias.each do |serveralias| %> <%= serveralias %><% end %>

<% if proxy != 'yes' -%>
        DocumentRoot <%= documentroot %>
        <Directory <%= documentroot %> >

                Options FollowSymLinks MultiViews
                AllowOverride All
                Order allow,deny
                allow from all

        </Directory>
<% else -%>
        ProxyPreserveHost <%= proxypreservehost %>
        ProxyRequests <%= proxyrequests %>
        ProxyPass <%= proxypath %> http://<%= proxytarget %>/
        ProxyPassReverse <%= proxypath %> http://<%= proxytarget %>/
<% end -%>

        # Possible values include: debug, info, notice, warn, error, crit,
        # alert, emerg.
        LogLevel warn

        CustomLog <%= baselogdir %>/<%= servername %>/access.log combined
        ErrorLog <%= baselogdir %>/<%= servername %>/error.log
        ServerSignature On

<% if webdav == 'yes' -%>
        <Location />
            DAV On
<% if webdav_auth == 'yes' -%>
            AuthType Basic
            AuthName "Webdav"
<% if ldap != 'yes' -%>
            AuthUserFile <%= documentroot %>/.htpasswd
<% else -%>
            AuthBasicProvider ldap
            AuthLDAPURL <%= ldap_url %>
            AuthLDAPBindDN <%= ldap_dn %>
            AuthLDAPBindPassword <%= ldap_pass %>
            AuthzLDAPAuthoritative off
<% end -%>
<% if allow_users == 'all' -%>
            Require valid-user
<% else -%>
            Require user <% allow_users.each do |user| %> <%= user %><% end %>
<% end -%>
<% end -%>
        </Location>
<% end -%>

</VirtualHost>

<% end -%>
<% if ssl == 'on' -%>
NameVirtualHost <%= ip %>:<%= sslport %>
<VirtualHost <%= servername %>:<%= sslport %>>

        ServerAdmin <%= serveradmin %>
        ServerName <%= servername %> 
        ServerAlias <% serveralias.each do |serveralias| %> <%= serveralias %><% end %>

<% if proxy != 'yes' -%>
        DocumentRoot <%= documentroot %>
        <Directory <%= documentroot %> >

                Options FollowSymLinks MultiViews
                AllowOverride All
                Order allow,deny
                allow from all

        </Directory>
<% else -%>
        ProxyRequests <%= proxyrequests %>
        ProxyPass <%= proxypath %> https://<%= proxytarget %>/
        ProxyPassReverse <%= proxypath %> https://<%= proxytarget %>/
<% end -%>

        # Possible values include: debug, info, notice, warn, error, crit,
        # alert, emerg.
        LogLevel warn

        CustomLog <%= baselogdir %>/<%= servername %>/access.log combined
        ErrorLog <%= baselogdir %>/<%= servername %>/error.log
        ServerSignature On

<% if webdav == 'yes' -%>
        <Location />
            DAV On
<% if webdav_auth == 'yes' -%>
            AuthType Basic
            AuthName "Webdav"
<% if ldap != 'yes' -%>
            AuthUserFile <%= documentroot %>/.htpasswd
<% else -%>
            AuthBasicProvider ldap
            AuthLDAPURL <%= ldap_url %>
            AuthLDAPBindDN <%= ldap_dn %>
            AuthLDAPBindPassword <%= ldap_pass %>
            AuthzLDAPAuthoritative off
<% end -%>
<% if allow_users == 'all' -%>
            Require valid-user
<% else -%>
            Require user <% allow_users.each do |user| %> <%= user %><% end %>
<% end -%>
<% end -%>
        </Location>
<% end -%>

        SSLEngine On
        SSLCertificateFile <%= ssl_certfile %>
        SSLCertificateKeyFile <%= ssl_keyfile %>

<% if proxy == 'yes' -%>
        SSLProxyEngine On
<% end -%>

</VirtualHost>
<% end -%>
